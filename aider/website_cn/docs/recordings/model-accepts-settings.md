---
parent: 屏幕录制
nav_order: 1
layout: minimal
highlight_image: /assets/recordings.jpg
description: 观看实现一个警告系统的过程，该系统在用户尝试将推理设置应用于不支持这些设置的模型时发出警告。包括添加模型元数据、确认对话框、重构和全面的测试覆盖。
---

# 用户应用不支持的推理设置时发出警告

<script>
const recording_id = "model-accepts-settings";
const recording_url = "https://gist.githubusercontent.com/paul-gauthier/66b1b5aa7136147702c98afc4987c0d4/raw/4b5c7ddf7e80db1ff4dfa78fe158bc000fc42e0e/accepts-settings.cast";
</script>

{% include recording.md %}

## 解说

- 0:01 用户有时会使用"推理"设置运行aider，但这些设置不被他们使用的模型所支持。这可能导致LLM API调用完全失败，并显示来自API提供商的非特定错误消息。我们将提前警告用户以防止这种情况。
- 0:25 好的，让我们请aider添加一个新的模型设置，我们可以在其中注明它支持哪些推理设置。然后，如果用户尝试应用不支持的设置，就打印一个警告。
- 1:30 看起来它包含了一些我们不需要的额外更改。
- 1:45 让我们看一下模型代码并清理一些多余的行。
- 2:00 警告逻辑太保守了。我们希望在设置未明确知道被支持时发出警告。
- 3:00 好的。现在让我们为高级用户添加一个设置，以便在他们故意这样做时可以静默这些警告。
- 3:45 现在我们需要更新模型设置数据库，注明哪些模型支持哪些推理设置。我们将从处理已知模型在未知提供商上的"回退"设置的代码开始。
- 4:45 哦，我们忘了给aider提供包含该代码的实际文件！Aider请求查看它。
- 5:00 好的，我们通过要求它更改它看不到的代码而让aider感到困惑。
- 5:10 让我们清除聊天记录并完善提示，再试一次。
- 6:00 看起来不错。让我们继续更新完整的模型设置数据库YAML文件。像"o1"这样的每个主要模型都会从多个提供商出现，如OpenAI、OpenRouter等。我们想要更新所有这些。
- 7:43 让我们打断并完善提示，以便更清楚地说明要更新哪些模型。
- 9:20 看起来不错。让我们检查YAML文件并快速浏览所有相关模型。
- 10:20 现在让我们做一些手动测试。
- 10:41 好的，它不应该警告我们使用Sonnet 3.7的"思考标记"。
- 10:55 让我们看看aider能否发现问题？
- 11:28 这听起来不像是一个有希望的解决方案。让我们添加更多相关代码，清除历史记录并再次尝试。
- 12:00 好的，让我们尝试aider提出的解决方案。
- 12:32 看看它是否有效... 不行！仍然收到不必要的警告。撤销那个更改！
- 12:48 是时候进行一些手动打印调试了。
- 13:00 似乎"accept_settings"值未被设置？
- 14:30 啊哈！我有一个Sonnet的本地模型设置文件，它覆盖了aider内置的设置。我们没有更新它。让我们在那里添加"accepts_settings"。
- 14:45 那是问题所在，这不是一个程序错误。
- 14:59 好的，让我们为所有这些内容添加测试覆盖。
- 15:09 当aider编写测试时，让我们使用"git diff"查看我们所做的所有更改。
- 15:34 Aider已完成编写测试，让我们尝试运行它们。
- 15:44 一个通过，一个失败。让我们先看一下通过的测试。
- 16:04 让我们看看aider能否修复失败的测试。
- 16:14 Aider需要查看另一个文件，这很合理。
- 16:29 它找到了问题，但正在尝试"修复"代码。我们希望它修复测试。
- 16:47 好的，测试现在通过了。
- 16:55 当用户即将破坏他们的API调用时，我们应该停下来询问用户"你确定吗？"，而不只是闪现一个警告。
- 17:59 好的，确认对话框看起来不错。
- 18:35 这段代码有点重复。让我们进行一些重构。
- 19:44 Sonnet搞乱了代码编辑指令，因此aider正在重试。
- 19:54 让我们清除聊天历史并再次尝试。
- 20:25 重构后测试是否仍然通过？
- 20:55 测试通过了，很好。让我们调整警告文本。
- 21:10 现在让我们请aider更新文档以解释这些更改。
- 22:32 让我们校对并编辑更新的文档。
- 24:25 以及对所有文档更改进行"git diff"，进行最终检查。
- 24:56 让我们请aider更新项目的HISTORY文件。
- 25:35 我们可以稍微优化HISTORY条目。
- 26:20 全部完成！






